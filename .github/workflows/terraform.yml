name: 'teraform'

on: 
    push:
        branches: ['stage']

jobs:
    terraform:
        name: 'Terraform'
        env:
        # AWS Secrets
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }} 
        runs-on: ubuntu-latest
        environment: stage

        steps:
        # Checkout the repository to the GitHub Action runner
        - name: Checkout
          uses: actions/checkout@v3
        
        # Initialize a new or existing Terraform working diirectory by creating initial files, loading any remote state, downloading moduls etc.
        - uses: hashicorp/setup-terraform@v3
        - name: Terraform Init
          id: init
          run: terraform init

        - name: Terraform Fmt
          id: fmt
          run: terraform fmt -check

        - name: Terraform Validate
          id: validate
          run: terraform validate -no-color

        - name: Terraform plan
          id: plan
          run: terraform plan -no-color -var="instance_type=t2.medium"
          continue-on-error: true
          

        



